{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Essence - Fashion Ecommerce Template</title>

    <!-- Favicon  -->
    <link rel="icon" href="{% static 'img/core-img/favicon.ico' %}">

    <!-- Core Style CSS -->
    {% include 'Components/csslinks.html' %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            overflow-x: hidden;
        }

        .quantity-wrapper {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 30px;
            overflow: hidden;
            height: 45px;
            flex: 1;
        }

        .qty-input {
            flex: 1;
            text-align: center;
            border: none;
            outline: none;
            font-size: 16px;
        }

        .qty-btn {
            width: 40px;
            height: 100%;
            border: none;
            background: #f5f5f5;
            font-size: 20px;
            cursor: pointer;
        }

        .qty-btn:hover {
            background: #ddd;
        }

        /* Product Image Carousel Styles */
        .product-image-carousel {
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            height: 500px;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .main-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.9);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #333;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .carousel-nav:hover {
            background: #fff;
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-prev {
            left: 15px;
        }

        .carousel-next {
            right: 15px;
        }

        .thumbnail-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            overflow-x: auto;
            padding: 5px 0;
        }

        .thumbnail-container::-webkit-scrollbar {
            height: 6px;
        }

        .thumbnail-container::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 3px;
        }

        .thumbnail-item {
            min-width: 80px;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .thumbnail-item:hover {
            border-color: #999;
        }

        .thumbnail-item.active {
            border-color: #333;
        }

        .thumbnail-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Responsive adjustments */
        .single_product_details_area {
            padding: 100px 40px 50px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: start;
            gap: 60px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .single_product_thumb {
            width: 100%;
            max-width: 600px;
            justify-self: end;
        }

        .single_product_desc {
            width: 100%;
            max-width: 600px;
            justify-self: start;
        }

        .single_product_desc > div:first-child {
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .main-image-container {
                height: 400px;
            }

            .single_product_details_area {
                grid-template-columns: 1fr;
                padding: 60px 15px 30px;
                gap: 30px;
            }

            .single_product_thumb,
            .single_product_desc {
                justify-self: center;
            }

            .carousel-nav {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <!-- ##### Header Area Start ##### -->
    <header class="header_area">
        {% include 'Components/navbar.html' %}
    </header>
    <!-- ##### Header Area End ##### -->

    <!-- ##### Single Product Details Area Start ##### -->
    <section class="single_product_details_area">

        <!-- Single Product Thumb with Carousel -->
        <div class="single_product_thumb">
            <div class="product-image-carousel">
                <!-- Main Image Container -->
                <div class="main-image-container">
                    <img id="mainProductImage" src="{{ DTProduct.productImage.url }}" alt="{{ DTProduct.productName }}">

                    <!-- Navigation Arrows -->
                    <button class="carousel-nav carousel-prev" onclick="changeImage(-1)">
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button class="carousel-nav carousel-next" onclick="changeImage(1)">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Thumbnail Container -->
                <div class="thumbnail-container" id="thumbnailContainer">
                    <!-- Main product image thumbnail -->
                    <div class="thumbnail-item active" onclick="selectImage(0, this)">
                        <img src="{{ DTProduct.productImage.url }}" alt="Main">
                    </div>

                    <!-- Additional product detail images -->
                    {% for detailImage in DTProductDetailImages %}
                    <div class="thumbnail-item" onclick="selectImage({{ forloop.counter }}, this)">
                        <img src="{{ detailImage.productDetailImage.url }}"
                             alt="{{ detailImage.productDetailImageName }}">
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Single Product Description -->
        <div class="single_product_desc clearfix">
            <div>
                <span>{{ DTProduct.genreID.genreName }}</span>
                <a href="{% url 'myapp:index' %}">
                    <h2>{{ DTProduct.productName }}</h2>
                </a>
                {% if DTProduct.originalPrice > 0 %}
                    <p class="product-price"><span class="old-price">${{ DTProduct.originalPrice }}</span> ${{ DTProduct.price }}</p>
                {% else %}
                    <p class="product-price">${{ DTProduct.price }}</p>
                {% endif %}
                <p class="product-desc">
                    {{ DTProduct.productDescription | safe }}
                </p>
                <!-- Form -->
                <form class="cart-form clearfix" method="post" action="{% url 'myapp:cart' DTProduct.id %}">
                    {% csrf_token %}

                    <div class="cart-fav-box" style="display: flex; flex-direction: column; gap: 15px; max-width: 400px;">

                        <!-- Quantity Box -->
                        <div class="quantity-wrapper">
                            <button type="button" class="qty-btn minus">âˆ’</button>
                            <input type="number" name="quantity" value="1" min="1" class="qty-input">
                            <button type="button" class="qty-btn plus">+</button>
                        </div>

                        <button type="submit" class="btn essence-btn" style="width: 100%;">
                            Add to cart
                        </button>
                    </div>
                </form>
                <h3>Review</h3><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aspernatur debitis distinctio, doloribus enim est ex excepturi impedit iste iusto minus molestiae necessitatibus non, quod repellendus soluta? Esse incidunt molestiae placeat.</p>

            </div>

            {% if DTProductDetail %}
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                <h4 style="color: #666; margin-bottom: 15px; font-weight: 600;">Reviews</h4>
                <div style="color: #333; line-height: 1.6;">{{ DTProductDetail.Reviews | safe }}</div>
            </div>
            {% endif %}
        </div>
    </section>
    <!-- ##### Single Product Details Area End ##### -->

    <!-- ##### Similar Products Area Start ##### -->
    <section class="similar_products_area section_padding_100_50" style="padding: 50px 0; background-color: #f9f9f9; width: 100vw;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-center mb-4">
                    <div class="section-heading">
                        <h2 style="font-weight: 700; font-size: 2rem; letter-spacing: 1px;">Similar Products</h2>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="similar-products-slides owl-carousel owl-theme">
                        {% for DTAllProduct in DTAllProduct %}
                        <div class="single-product-wrapper" style="background: #fff; border-radius: 10px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); padding: 15px; text-align: center; margin: 10px;">
                            <div class="product-img" style="overflow: hidden; border-radius: 10px;">
                                <img src="{{ DTAllProduct.productImage.url }}" alt="" style="width: 100%; height: 250px; object-fit: cover; transition: transform 0.3s;">
                            </div>
                            <div class="product-description mt-3">
                                <span style="color: #999; font-size: 0.85rem;">{{ DTAllProduct.genreID.genreName }}</span>
                                <a href="{% url 'myapp:single_product_details' DTAllProduct.genreID.id DTAllProduct.id %}">
                                    <h6 style="font-weight: 600; font-size: 1rem; margin: 5px 0;">{{ DTAllProduct.productName }}</h6>
                                </a>
                                <p class="product-price" style="font-weight: 700; color: #333;">${{ DTAllProduct.price }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- ##### Similar Products Area End ##### -->

    <!-- ##### Footer Area Start ##### -->
    <footer class="footer_area clearfix">
        {% include 'Components/footer.html' %}
    </footer>
    <!-- ##### Footer Area End ##### -->

    {% include 'Components/jslinks.html' %}

    <script>
        // Similar products carousel
        $('.similar-products-slides').owlCarousel({
            loop: true,
            margin: 20,
            nav: false,
            dots: false,
            smartSpeed: 600,
            autoplay: true,
            autoplayTimeout: 4000,
            autoplayHoverPause: true,
            navText: [
                '<i class="fa fa-chevron-left"></i>',
                '<i class="fa fa-chevron-right"></i>'
            ],
            responsive: {
                0: { items: 1 },
                576: { items: 2 },
                768: { items: 3 },
                992: { items: 4 },
                1200: { items: 5 }
            }
        });

        // Quantity controls
        document.addEventListener("DOMContentLoaded", function () {
            const minusBtn = document.querySelector(".minus");
            const plusBtn = document.querySelector(".plus");
            const qtyInput = document.querySelector(".qty-input");

            minusBtn.addEventListener("click", () => {
                if (qtyInput.value > 1) {
                    qtyInput.value--;
                }
            });

            plusBtn.addEventListener("click", () => {
                qtyInput.value++;
            });
        });

        // Image carousel functionality
        let currentImageIndex = 0;
        const images = [];

        // Collect all images (main + detail images)
        images.push("{{ DTProduct.productImage.url }}");
        {% for detailImage in DTProductDetailImages %}
        images.push("{{ detailImage.productDetailImage.url }}");
        {% endfor %}

        function changeImage(direction) {
            currentImageIndex += direction;

            if (currentImageIndex < 0) {
                currentImageIndex = images.length - 1;
            } else if (currentImageIndex >= images.length) {
                currentImageIndex = 0;
            }

            updateMainImage();
        }

        function selectImage(index, thumbnailElement) {
            currentImageIndex = index;
            updateMainImage();

            // Update active thumbnail
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.classList.remove('active');
            });
            thumbnailElement.classList.add('active');
        }

        function updateMainImage() {
            const mainImage = document.getElementById('mainProductImage');
            mainImage.style.opacity = '0';

            setTimeout(() => {
                mainImage.src = images[currentImageIndex];
                mainImage.style.opacity = '1';
            }, 150);

            // Update active thumbnail
            const thumbnails = document.querySelectorAll('.thumbnail-item');
            thumbnails.forEach((thumb, index) => {
                if (index === currentImageIndex) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
        }

        // Add smooth transition to main image
        document.getElementById('mainProductImage').style.transition = 'opacity 0.3s ease';
    </script>
</body>
</html>